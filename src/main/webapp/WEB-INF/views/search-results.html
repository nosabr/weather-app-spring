<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head th:replace="~{fragments/common :: head('–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞')}"></head>

<!-- –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞ -->
<link rel="stylesheet" th:href="@{/static/css/search-style.css}">

<body>

<div th:replace="~{fragments/common :: header}"></div>

<main class="container my-5">
    <!-- Breadcrumbs -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/}">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li class="breadcrumb-item active" aria-current="page">–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞</li>
        </ol>
    </nav>

    <!-- Search Section -->
    <div class="row justify-content-center mb-5">
        <div class="col-lg-8 col-md-10">
            <div class="search-container">
                <h1 class="text-center search-title">üîç –ù–∞–π—Ç–∏ –≥–æ—Ä–æ–¥</h1>
                <p class="text-center text-muted mb-4">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥—ã</p>

                <form th:action="@{/search}" method="get" class="search-form">
                    <div class="input-group input-group-lg shadow-sm">
                        <input type="text"
                               class="form-control search-input"
                               name="cityName"
                               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: London, Tokyo, Paris..."
                               required
                               th:value="${cityName}">
                        <button class="btn btn-primary search-btn" type="submit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                            </svg>
                            <span class="ms-2">–ò—Å–∫–∞—Ç—å</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Error Message -->
    <!--/*@thymesVar id="error" type="java.lang.String"*/-->
    <div class="row justify-content-center mb-4" th:if="${error != null}">
        <div class="col-lg-8 col-md-10">
            <div class="alert alert-danger alert-dismissible fade show error-alert" role="alert">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                </svg>
                <span th:text="${error}">–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <!--/*@thymesVar id="success" type="java.lang.String"*/-->
    <div class="row justify-content-center mb-4" th:if="${success != null}">
        <div class="col-lg-8 col-md-10">
            <div class="alert alert-success alert-dismissible fade show success-alert" role="alert">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                </svg>
                <span th:text="${success}">–ì–æ—Ä–æ–¥ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- Search Result -->
    <!--/*@thymesVar id="weatherResponseDTO" type="com.example.weatherapp.dto.WeatherData"*/-->
    <div class="row justify-content-center" th:if="${weatherResponseDTO != null}">
        <div class="col-lg-8 col-md-10">
            <div class="result-card">
                <div class="result-header">
                    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞</h2>
                </div>

                <div class="weather-result">
                    <div class="row align-items-center">
                        <!-- Weather Icon -->
                        <div class="col-md-4 text-center">
                            <img th:src="@{'https://openweathermap.org/img/wn/' + ${weatherResponseDTO.icon} + '@4x.png'}"
                                 alt="Weather icon"
                                 class="weather-result-icon">
                        </div>

                        <!-- Weather Info -->
                        <div class="col-md-8">
                            <div class="weather-info">
                                <h3 class="city-name" th:text="${weatherResponseDTO.name} + ', ' + ${weatherResponseDTO.country}">
                                    London, GB
                                </h3>

                                <div class="temperature" th:text="${weatherResponseDTO.temperature} + '¬∞C'">
                                    15¬∞C
                                </div>

                                <p class="description" th:text="${weatherResponseDTO.description}">
                                    Clear sky
                                </p>

                                <div class="weather-details">
                                    <div class="detail-item">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5h-2zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a28.458 28.458 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a28.458 28.458 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001L7 1.5zm0 0-.364-.343L7 1.5zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267z"/>
                                        </svg>
                                        <span>–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ <strong th:text="${weatherResponseDTO.feelsLike} + '¬∞C'">12¬∞C</strong></span>
                                    </div>

                                    <div class="detail-item">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5h-2zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a28.458 28.458 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a28.458 28.458 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001L7 1.5zm0 0-.364-.343L7 1.5zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267z"/>
                                        </svg>
                                        <span>–í–ª–∞–∂–Ω–æ—Å—Ç—å <strong th:text="${weatherResponseDTO.humidity} + '%'">70%</strong></span>
                                    </div>
                                </div>

                                <form th:action="@{/search}" method="post" class="mt-4">
                                    <!-- –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ -->
                                    <input type="hidden" name="name" th:value="${weatherData.name}">
                                    <input type="hidden" name="latitude" th:value="${weatherData.latitude}">
                                    <input type="hidden" name="longitude" th:value="${weatherData.longitude}">

                                    <!-- –ï—Å–ª–∏ –≥–æ—Ä–æ–¥ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω -->
                                    <button type="button"
                                            class="btn btn-info btn-already-added"
                                            disabled
                                            th:if="${isAlreadyAdded}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                                            <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                                        </svg>
                                        –ì–æ—Ä–æ–¥ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω
                                    </button>

                                    <!-- –ï—Å–ª–∏ –≥–æ—Ä–æ–¥ –ù–ï –¥–æ–±–∞–≤–ª–µ–Ω -->
                                    <button type="submit"
                                            class="btn btn-success btn-add-location"
                                            th:unless="${isAlreadyAdded}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                        </svg>
                                        –î–æ–±–∞–≤–∏—Ç—å –≤ –º–æ–∏ –ª–æ–∫–∞—Ü–∏–∏
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- No Results State -->
    <div class="row justify-content-center" th:if="${cityName != null and weatherResponseDTO == null and error == null}">
        <div class="col-lg-8 col-md-10">
            <div class="empty-search-state text-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="text-muted mb-3" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                </svg>
                <h4 class="text-muted">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞</h4>
            </div>
        </div>
    </div>
</main>

<div th:replace="~{fragments/common :: footer}"></div>
<div th:replace="~{fragments/common :: scripts}"></div>

</body>
</html>